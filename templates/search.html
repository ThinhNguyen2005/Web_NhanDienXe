{% extends "base.html" %}

{% block title %}Tra cứu vi phạm - Traffic Violation{% endblock %}

{% block content %}
<section class="container my-5">
    <div class="card shadow-lg border-0 rounded-4 p-4">
        <h2 class="card-title text-center mb-5 fw-bold text-dark-blue">
            <i class="fas fa-search me-3 text-primary"></i>Tra Cứu Thông Tin Vi Phạm
        </h2>
        
        <form class="mb-5" method="POST">
            <div class="input-group input-group-lg mb-3 shadow-sm rounded-pill overflow-hidden">
                <input type="text" class="form-control border-0 bg-light" id="license_plate" name="license_plate" 
                       placeholder="Ví dụ: 59A-12345" value="{{ search_query }}" required>
                <button class="btn btn-primary px-4 fw-bold" type="submit">
                    <i class="fas fa-search me-2"></i>Tìm kiếm
                </button>
            </div>
        </form>

        {% if search_query %}
        <div class="mt-4">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-body p-4">
                    <h5 class="mb-3 fw-bold text-dark-blue">
                        <i class="fas fa-list me-2 text-primary"></i>Kết quả tìm kiếm cho: "<span class="text-danger">{{ search_query }}</span>"
                    </h5>
                    {% if violations %}
                    <p class="text-success fw-bold">Tìm thấy {{ violations|length }} vi phạm</p>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Biển số xe</th>
                                    <th>Thời gian vi phạm</th>
                                    <th>Frame</th>
                                    <th>Độ tin cậy</th>
                                    <th>Thời gian lưu</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for violation in violations %}
                                <tr>
                                    <td><strong class="text-danger">{{ violation.license_plate }}</strong></td>
                                    <td>{{ violation.timestamp[:19].replace('T', ' ') }}</td>
                                    <td>{{ violation.frame_number }}</td>
                                    <td>
                                        <span class="badge bg-{% if violation.confidence > 0.8 %}success{% elif violation.confidence > 0.6 %}warning{% else %}danger{% endif %}">
                                            {{ "%.1f%%"|format((violation.confidence or 0) * 100) }}
                                        </span>
                                    </td>
                                    <td>{{ violation.created_at[:19].replace('T', ' ') if violation.created_at else 'N/A' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- <div class="alert alert-warning mt-4 rounded-3 shadow-sm" role="alert">
                        <h6 class="alert-heading fw-bold"><i class="fas fa-exclamation-triangle me-2"></i>Thông tin quan trọng:</h6>
                        <ul class="mb-0">
                            <li>Tất cả thông tin vi phạm được ghi nhận tự động bởi hệ thống AI</li>
                            <li>Độ tin cậy thể hiện mức độ chắc chắn khi nhận diện biển số</li>
                            <li>Dữ liệu chỉ mang tính chất tham khảo</li>
                        </ul>
                    </div> -->
                    {% else %}
                    <div class="alert alert-info text-center rounded-3 shadow-sm" role="alert">
                        <i class="fas fa-info-circle fa-2x mb-3 text-info"></i>
                        <h5 class="fw-bold">Không tìm thấy kết quả</h5>
                        <p class="mb-0">Không có vi phạm nào với biển số **"{{ search_query }}"**</p>
                        <small class="text-muted">Thử tìm kiếm với từ khóa khác hoặc kiểm tra lại biển số.</small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}

        <hr class="my-5">

        <div class="row g-4">
            <div class="col-md-6">
                <div class="card h-100 shadow-sm border-0 rounded-3">
                    <div class="card-body p-4">
                        <h4 class="card-title fw-bold text-dark-blue mb-3">
                            <i class="fas fa-info-circle me-2 text-info"></i>Hướng dẫn tra cứu
                        </h4>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Nhập đầy đủ biển số: **59A-123.45**</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Tìm theo một phần: **59A** hoặc **12345**</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Hệ thống không phân biệt chữ hoa, chữ thường.</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Kết quả sẽ hiển thị tất cả các vi phạm liên quan.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100 shadow-sm border-0 rounded-3">
                    <div class="card-body p-4">
                        <h4 class="card-title fw-bold text-dark-blue mb-3">
                            <i class="fas fa-shield-alt me-2 text-warning"></i>Chính sách bảo mật
                        </h4>
                        <p class="text-muted mb-0">
                            Tất cả thông tin tra cứu được ghi log để đảm bảo an ninh. Chỉ sử dụng hệ thống này cho mục đích chính đáng và tuân thủ các quy định về bảo vệ dữ liệu cá nhân.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
</section>
{% endblock %}